## 概要
为了照护服务项目落地，本期需要实现以下功能：

2. 服务类目模板化。类目下服务商品、商品标准服务步骤、服务使用方式（预约制、预付制）、支付方式（线上、线下）、订单服务周期（单次服务、一天多次、多天全时服务）、服务人员配置及权限（护工、评估师），抽象出类目模板对象。

以上功能中提到的服务和订单和原合肥上门护理服务没有关系，考虑兼容原有数据，本期设计开发基于原有模型进行改造开发。

## 服务类目模板化

在优护家现有服务类目中，针对各个类目下商品服务的属性，抽象出每个类目的共有属性，进行统一管理，商品模型的类目继承该类目。

评估服务类目下的所有商品，都具有服务方式、支付方式、订单周期等属性，那么只要把这些属性关联到这些类目，那么其下面的商品自然就拥有这些属性。

### 数据模型

服务类目模板采用tag的模型，可以创建一种新的tag，如`type=serviceCategory`，tag_property表存它的属性.

### 属性

* 基本属性`key=categoryProperty` 
    value:

    ```json
    {
        "property": {
            "subscribeType":["预约", "预付"],
            "payType": ["线上", "线下"],
            "servicePeriods": ["单次", "一天3次", "多天全时"]
        }
    }   
    ```
    
### 标准服务步骤

角色定义：

```java
public enum CatOrderUserTypeEnum {
    ADMIN(1, "管理员"),
    ACCOUNTANT(2, "财务"),
    MANAGER(3, "客服经理"),
    SUPERVISOR(4, "评估师"),
    USER(5, "用户"),
    CAREWORKER(6, "护工");
    ADMIN(1, "管理员"),
    ACCOUNTANT(2, "财务"),
    MANAGER(3, "客服经理"),
    SUPERVISOR(4, "评估师"),
    USER(5, "用户"),
    CAREWORKER(6, "护工");
}
```
之前的服务步骤没有指定角色，本期商品服务的服务步骤中关系到护工任务只能由护工完成，评估只能由评估师完成，而且两者之间有依赖

```json
{
    "careStep": {
        "title":"护工日/夜间照料"
        "something": "something"
        "executorType": 6
    },
    "evaluationStep": {
       {
         "articleSection": [
           {
             "title": "健康宣教知识",
             "desc": "下单后，系统自动向患者开放服务的健康宣教知识",
             "article": [
               {
                 "id": 8737,
                 "title": "鼻饲居家护理",
                 "read": false
               }
             ],
             "order": 1
           }
         ],
         "toolSection": [
           {
             "title": "全面了解身体情况",
             "desc": "服务前患者进行自我测评",
             "tool": [
               {
                 "id": 970,
                 "title": "生活自理能力评估表",
                 "summary": ""
               },
               {
                 "id": 987,
                 "title": "记忆障碍自评表",
                 "summary": ""
               }
             ],
             "order": 1
           }
         ],
         "evaluateSection": [
           {
             "title": "服务前评估",
             "desc": "电话评估客户情况，判断是否上门服务",
             "evaluate": [
               {
                 "id": 988,
                 "title": "鼻饲电话评估",
                 "summary": ""
               }
             ],
             "order": 1
           },
           {
             "title": "上门服务评估",
             "desc": "服务中对客户进行全面的评估，综合了解客户的身体情况，为服务提供有效信息",
             "evaluate": [
               {
                 "id": 977,
                 "title": "基础评估",
                 "summary": ""
               },
               {
                 "id": 989,
                 "title": "鼻饲专项评估",
                 "summary·  ": ""
               }
             ],
             "order": 2
           }
         ],
         "stepSection": [
           {
             "title": "服务操作",
             "desc": "按照鼻饲护理规范完成操作步骤",
             "order": 1
           }
         ]
       },
       "executorType":4
    },
    "categoryId": 5
}
```

以上，每个类目可能有不同的服务步骤。本期暂时提前录入各个类目对应的服务步骤，后期实现服务步骤的管理功能。

此处涉及的executorType是用于产生新订单时判断是当前人是否有权限接单。这样一来，设计到服务商品的可服务人员信息配置。商品和服务人员关系暂由tag模型进行存储，本期暂时由后台操作配置服务人员信息，后期在商品服务发布系统中，根据服务商品的标准化服务步骤信息，来配置商品服务的服务人员信息。


## 服务商品模板化

### 类模板属性

每个商品都有category, 这就间接的继承了category的属性，这些信息可以从category的属性信息中获取。所以只要设计好类目模板模型就好了。

### 多服务属性

现有商品模型仅支持多属性单属性值，为了向C端用户提供更多选择，即需要支持多个属性多个属性值，再由属性值交叉生成不同的service_item, 患者在C端可以根据属性值去选择哪种服务商品。

此处商品的属性和属性值是指包含继承自类模板的属性和属性值。

### 折扣设置
可以在item表添加一个字段，表示商品打几折，但该信息并不返回到C端，给用户展示，只是在用户付款的时候，进行价格折扣。

## 订单流转

## 针对服务步骤的接单和服务设计

创建一个新的接单记录表：orderRecord

| 字段 | 说明 | 类型 |
| --- | --- | --- |
| id | 主键 | long |
| order_id | 订单的id | long |
| step_order | 服务步骤的顺序 | int |
| role_id | 服务该步骤人的id | long |
| role_type | 服务该步骤人的类型 | int |
| is_accepeted | 该服务步骤是否被接受（0：未接；1：已接） | bit |
| is_finished | 该服务步骤是否被完成（0：未完成；1：已完成） | bit |

### 接单时详情

由于服务步骤的每一步都有可能是需要不同角色去完成，所以在接单时，服务人员是去接的具体服务步骤：
例如：一个患者创建了一个订单，该订单的服务步骤有：（1）身体健康评估（服务角色：评估师）；（2）尿管护理（服务角色：护工）。
这个时候服务人员去接单的时候，是去接这个（1）（2）的步骤，且评估师只能接取（1）这个步骤，护工只能接取（2）这个步骤。当评估师或者护工接取该订单的步骤，该订单就不会显示给该类角色。只有当所有的服务步骤全部被接取患者端才能看见此订单被接收。


